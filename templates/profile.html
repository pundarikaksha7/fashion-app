{% extends 'base.html' %}
{% load static %}

{% block title %}Profile - {{ user_profile.user.username }}{% endblock %}

{% block content %}
<section class="max-w-5xl mx-auto space-y-10">
  <header class="flex flex-col md:flex-row md:items-center md:justify-between gap-8 bg-white p-10 rounded-3xl shadow-lg select-none">
    <div class="flex items-center gap-8">
      <img src="{{ user_profile.profileimg.url }}" alt="Profile image of {{ user_profile.user.username }}" class="w-40 h-40 rounded-full object-cover border-6 border-[#ed9f0e] shadow-md" />
      <div>
        <h1 class="text-5xl font-extrabold tracking-tight text-[#ed9f0e]">@{{ user_profile.user.username }}</h1>
        {% if user_profile.location %}
        <p class="flex items-center gap-2 mt-2 text-gray-600 text-lg font-medium">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#6b7280" stroke-width="2" viewBox="0 0 24 24" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M12 21C12 21 7 13.5 7 9a5 5 0 1 1 10 0c0 4.5-5 12-5 12z"/></svg>
          {{ user_profile.location }}
        </p>
        {% endif %}
        {% if user != user_profile.user %}
  <form action="{% url 'follow' %}" method="POST" class="mt-4 inline-block">
    {% csrf_token %}
    <input type="hidden" name="follower" value="{{ user.username }}">
    <input type="hidden" name="user" value="{{ user_profile.user.username }}">

    {% if button_text == 'Unfollow' %}
  <button type="submit" class="text-sm px-5 py-2 rounded-xl border border-[#ed9f0e] text-[#ed9f0e] hover:bg-[#ed9f0e] hover:text-white transition select-none">
    <i class="fa fa-check mr-1"></i> Unfollow
  </button>
{% else %}
  <button type="submit" class="text-sm px-5 py-2 rounded-xl bg-[#ed9f0e] text-white hover:bg-[#ed9f0e] transition select-none">
    <i class="fa fa-plus mr-1"></i> Follow
  </button>
{% endif %}
  </form>
{% endif %}


      </div>
    </div>
    <div class="flex justify-around md:justify-between gap-12 w-full max-w-md">
      <div class="text-center">
        <p class="text-5xl font-extrabold text-gray-800">{{ user_post_length }}</p>
        <p class="uppercase text-xs text-gray-500 tracking-wide">{% if user_post_length == 1 %}Post{% else %}Posts{% endif %}</p>
      </div>
      <div class="text-center">
        <p class="text-5xl font-extrabold text-gray-800">{{ user_followers }}</p>
        <p class="uppercase text-xs text-gray-500 tracking-wide">{% if user_followers == 1 %}Follower{% else %}Followers{% endif %}</p>
      </div>
      <div class="text-center">
        <p class="text-5xl font-extrabold text-gray-800">{{ user_following }}</p>
        <p class="uppercase text-xs text-gray-500 tracking-wide">Following</p>
      </div>
    </div>
  </header>

  <section class="bg-white p-8 rounded-3xl shadow-lg">
    <h2 class="text-3xl font-semibold mb-6 select-none">About</h2>
    <p class="text-gray-700 leading-relaxed text-lg min-h-[80px]">{% if user_profile.bio %}{{ user_profile.bio }}{% else %}<em class="text-gray-400 italic">No bio available</em>{% endif %}</p>
  </section>

  <section>
    <h2 class="text-3xl font-semibold mb-8 select-none">Posts</h2>
    {% if user_posts %}
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8">
      {% for post in user_posts %}
      <article class="relative rounded-2xl overflow-hidden shadow-md cursor-pointer hover:shadow-xl transition-shadow duration-300 group">
        <img src="{{ post.image.url }}" alt="Post Image by {{ post.user }}" class="w-full h-64 object-cover select-none" loading="lazy" />
        <div class="absolute bottom-0 inset-x-0 bg-gradient-to-t from-black/80 to-transparent text-white px-4 py-3 flex justify-between items-center text-sm font-semibold">
          <div class="flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="h-6 w-6 text-red-500" viewBox="0 0 20 20">
              <path d="M3.172 5.172a4 4 0 015.656 0L10 6.342l1.172-1.17a4 4 0 115.656 5.656L10 17.656l-6.828-6.828a4 4 0 010-5.656z"/>
            </svg>
            <span id="likes-count-grid-{{ post.id }}">{{ post.no_of_likes }}</span>
          </div>
          <div class="flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" fill="#4dabf7" class="h-6 w-6" viewBox="0 0 24 24"><path d="M21 6h-2v9H7v2c0 0.55 0.45 1 1 1h9l4 4V7c0-0.55-0.45-1-1-1zM3 17l4-4H3v4z"/></svg>
            <span id="comments-count-grid-{{ post.id }}">{{ post.comments.count }}</span>
          </div>
        </div>
      </article>
      {% endfor %}
    </div>
    {% else %}
    <p class="text-center text-gray-400 font-semibold mt-20 select-none">No posts yet.</p>
    {% endif %}
  </section>
</section>
{% endblock %}
